
spring:
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration
      - org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration

@Service
@ConditionalOnProperty(prefix = "transformer",
                      name = "account-status-loading-source",
                      havingValue = "database")
@RequiredArgsConstructor
public class AccountStatusMappingServiceDbImpl implements AccountStatusMappingService {

    private final GapiMappingTransformerRepository repo;
    private final ObjectMapper objectMapper;

    @Override
    public AccountStatusMapping loadAccountStatusMapping() {
        GapiMappingTransformerEntity entity =
            repo.findByMappingId("account-status-mapping")
                .orElseThrow(() -> new TransformationException("Mapping not found"));

        JsonNode root = objectMapper.readTree(entity.getMappingJson());

        return objectMapper.treeToValue(
                root.get("account-status-mapping"),
                AccountStatusMapping.class
        );
    }

    @Override
    public AccountStatusCodeMapping loadAccountStatusCodeMapping() {
        GapiMappingTransformerEntity entity =
            repo.findByMappingId("account-status-code-mapping")
                .orElseThrow(() -> new TransformationException("Mapping not found"));

        JsonNode root = objectMapper.readTree(entity.getMappingJson());

        return objectMapper.treeToValue(
                root.get("accountStatusCodeMapping"),
                AccountStatusCodeMapping.class
        );
    }
}







<dependency>
			<groupId>org.mariadb.jdbc</groupId>





			<artifactId>mariadb-java-client</artifactId>
			<scope>runtime</scope>
		</dependency>
spring:
  datasource:
    url: jdbc:h2:mem:transformerdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    driver-class-name: org.h2.Driver
    username: sa
    password:

  h2:
    console:
      enabled: true

management:
  endpoints:
    web:
      exposure:
        include: health,info,h2-console
  endpoint:
    h2-console:
      enabled: true



<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-jpa</artifactId>
</dependency>



<dependency>
    <groupId>com.h2database</groupId>
    <artifactId>h2</artifactId>
    <scope>runtime</scope>
</dependency>



CREATE TABLE IF NOT EXISTS gapi_mapping_transformers (
    mapping_id VARCHAR(255) PRIMARY KEY,
    mapping_json CLOB NOT NULL,
    mapping_json_staging CLOB,
    ticket_id VARCHAR(16),
    approval_status VARCHAR(16),
    created_by VARCHAR(64),
    modified_by VARCHAR(64),
    approved_by VARCHAR(64),
    modified_by_staging VARCHAR(64),
    created_time TIMESTAMP,
    modified_time TIMESTAMP,
    approved_time TIMESTAMP,
    modified_time_staging TIMESTAMP,
    updated_time TIMESTAMP
);


@Entity
@Table(name = "gapi_mapping_transformers")
@Data
public class GapiMappingTransformerEntity {

    @Id
    @Column(name = "mapping_id", length = 255)
    private String mappingId;    // Primary key (e.g., "account-status-mapping")

    @Lob
    @Column(name = "mapping_json", nullable = false)
    private String mappingJson;   // Main JSON

    @Lob
    @Column(name = "mapping_json_staging")
    private String mappingJsonStaging;   // Staging JSON

    @Column(name = "ticket_id", length = 16)
    private String ticketId;

    @Column(name = "approval_status", length = 16)
    private String approvalStatus; // PENDING / APPROVED / REJECTED

    @Column(name = "created_by", length = 64)
    private String createdBy;

    @Column(name = "modified_by", length = 64)
    private String modifiedBy;

    @Column(name = "approved_by", length = 64)
    private String approvedBy;

    @Column(name = "modified_by_staging", length = 64)
    private String modifiedByStaging;

    @Column(name = "created_time", updatable = false)
    private LocalDateTime createdTime;

    @Column(name = "modified_time")
    private LocalDateTime modifiedTime;

    @Column(name = "approved_time")
    private LocalDateTime approvedTime;

    @Column(name = "modified_time_staging")
    private LocalDateTime modifiedTimeStaging;

    @Column(name = "updated_time")
    private LocalDateTime updatedTime;
}
